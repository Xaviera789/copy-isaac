---
name: é˜¶æ®µ2åä½œåˆ†å·¥æ–¹æ¡ˆ
overview: ""
todos: []
---

# é˜¶æ®µ2ï¼šæ•Œäººå’Œæˆ˜æ–—ç³»ç»Ÿ - åä½œåˆ†å·¥æ–¹æ¡ˆ

## ğŸ“‹ é˜¶æ®µæ¦‚è¿°

**ç›®æ ‡**: æ·»åŠ åŸºç¡€æ•Œäººå’Œæˆ˜æ–—æœºåˆ¶ï¼Œå®ç°ç©å®¶ä¸æ•Œäººçš„å®Œæ•´æˆ˜æ–—å¾ªç¯

**åŒ…å«å†…å®¹**:

- 2.1 æ•ŒäººåŸºç¡€ç³»ç»Ÿ
- 2.2 æˆ˜æ–—ç³»ç»Ÿå®Œå–„  
- 2.3 æ•Œäººç±»å‹æ‰©å±•

**é‡è¦è¯´æ˜**ï¼š

- âœ… **Damageable åŸºç±»å·²å®ç°**ï¼š`Damageable` ç»§æ‰¿è‡ª `CharacterBody2D`ï¼Œæä¾›äº†ç”Ÿå‘½å€¼ã€æ— æ•Œå¸§å’Œä¼¤å®³å¤„ç†åŠŸèƒ½
- âœ… **Player å·²ç»§æ‰¿ Damageable**ï¼š`Player` ç»§æ‰¿è‡ª `Damageable`ï¼Œå·²å…·å¤‡ç”Ÿå‘½å€¼ç³»ç»ŸåŸºç¡€
- âœ… **EnemyBase å·²ç»§æ‰¿ Damageable**ï¼š`EnemyBase` ç»§æ‰¿è‡ª `Damageable`ï¼Œå·²å…·å¤‡ç”Ÿå‘½å€¼ç³»ç»ŸåŸºç¡€

**ç»§æ‰¿å…³ç³»**ï¼š
```
CharacterBody2D
  â””â”€â”€ Damageable (æä¾›ç”Ÿå‘½å€¼ã€æ— æ•Œå¸§ã€ä¼¤å®³å¤„ç†)
       â”œâ”€â”€ Player
       â””â”€â”€ EnemyBase
```

---

## ğŸ‘¥ å¼€å‘è€…åˆ†å·¥

### ğŸ‘¤ å¼€å‘è€…Aï¼šç©å®¶ä¸æˆ¿é—´ç³»ç»Ÿ

**è´Ÿè´£æ¨¡å—ï¼š**

- âœ… é˜¶æ®µ1å·²å®Œæˆï¼šç©å®¶ç§»åŠ¨ã€æˆ¿é—´è¾¹ç•Œ
- ğŸ”„ é˜¶æ®µ2ä»»åŠ¡ï¼š
  - **ç©å®¶ç”Ÿå‘½å€¼ç³»ç»Ÿ**ï¼ˆ2.2çš„ä¸€éƒ¨åˆ†ï¼‰
  - **æˆ¿é—´æ•Œäººç”Ÿæˆæ”¯æŒ**ï¼ˆ2.3çš„ä¸€éƒ¨åˆ†ï¼Œä¸å¼€å‘è€…Båä½œï¼‰

**æ ¸å¿ƒèŒè´£ï¼š**

- âœ… **å·²å®Œæˆ**ï¼šPlayerå·²ç»§æ‰¿Damageableï¼Œç”Ÿå‘½å€¼ã€ä¼¤å®³ã€æ­»äº¡é€»è¾‘åŸºç¡€å·²å…·å¤‡
- âœ… **å·²å®Œæˆ**ï¼šPlayerçš„æ­»äº¡é€»è¾‘å·²å®Œå–„ï¼ˆé‡å†™die()æ–¹æ³•ï¼Œå®ç°æ¸¸æˆé‡å¯é€»è¾‘ï¼Œä½¿ç”¨get_tree().reload_current_scene()ï¼‰
- âœ… **å·²å®Œæˆ**ï¼šä¼¤å®³åé¦ˆæ•ˆæœå·²å®ç°ï¼ˆé—ªçƒæ•ˆæœç³»ç»Ÿï¼Œä½¿ç”¨sinå‡½æ•°åˆ›å»ºå¹³æ»‘é—ªçƒï¼Œä¸æ— æ•Œå¸§åŒæ­¥ï¼‰
- âœ… **å·²å®Œæˆ**ï¼šç”Ÿå‘½å€¼åˆå§‹åŒ–å·²å®ç°ï¼ˆinitial_hp = 3ï¼Œåœ¨_readyä¸­åˆå§‹åŒ–å¹¶æ‰“å°ï¼‰
- âœ… **å·²å®Œæˆ**ï¼šç©å®¶ä½ç½®å¯é€šè¿‡Player.global_positionç›´æ¥è®¿é—®ï¼Œä¾›æ•ŒäººAIä½¿ç”¨
- ğŸ”„ ä¸ºæ•Œäººç”Ÿæˆç³»ç»Ÿæä¾›æˆ¿é—´è¾¹ç•Œå’Œç”Ÿæˆä½ç½®æ”¯æŒï¼ˆå¾…Step 8å®ç°ï¼‰

---

### ğŸ‘¤ å¼€å‘è€…Bï¼šæˆ˜æ–—ä¸æ•Œäººç³»ç»Ÿ

**è´Ÿè´£æ¨¡å—ï¼š**

- âœ… é˜¶æ®µ1å·²å®Œæˆï¼šå°„å‡»ç³»ç»Ÿã€å­å¼¹ç³»ç»Ÿ
- ğŸ”„ é˜¶æ®µ2ä»»åŠ¡ï¼š
  - **æ•ŒäººåŸºç¡€ç³»ç»Ÿ**ï¼ˆ2.1ï¼‰
  - **æˆ˜æ–—ç³»ç»Ÿå®Œå–„**ï¼ˆ2.2çš„ä¸»è¦éƒ¨åˆ†ï¼‰
  - **æ•Œäººç±»å‹æ‰©å±•**ï¼ˆ2.3ï¼‰

**æ ¸å¿ƒèŒè´£ï¼š**

- âœ… **å·²å®Œæˆ**ï¼šEnemyBaseå·²ç»§æ‰¿Damageableï¼Œç”Ÿå‘½å€¼ã€ä¼¤å®³ã€æ­»äº¡é€»è¾‘åŸºç¡€å·²å…·å¤‡
- âœ… **å·²å®Œæˆ**ï¼šEnemyBaseçš„AIé€»è¾‘å·²å®Œå–„ï¼ˆå®ç°_find_player_targetè‡ªåŠ¨æŸ¥æ‰¾ç©å®¶ï¼Œå®Œå–„è¿½è¸ªç§»åŠ¨é€»è¾‘_handle_chaseï¼Œå®ç°æˆ¿é—´è¾¹ç•Œé™åˆ¶_limit_to_room_boundså’Œ_limit_velocity_to_boundsï¼‰
- ğŸ”„ å®ç°æ•Œäººç¢°æ’ä¼¤å®³é€»è¾‘ï¼ˆå¾…Step 4å®ç°ï¼‰
- ğŸ”„ å®Œå–„å­å¼¹ä¸æ•Œäººçš„ç¢°æ’æ£€æµ‹å’Œä¼¤å®³ç³»ç»Ÿï¼ˆå¾…Step 3å®ç°ï¼‰
- ğŸ”„ å®ç°å¤šç§æ•Œäººç±»å‹å’Œæ•Œäººç”Ÿæˆç³»ç»Ÿï¼ˆå¾…Step 7å’ŒStep 8å®ç°ï¼‰

---

## ğŸš¨ å…³é”®è€¦åˆå…³ç³»ï¼ˆå¿…é¡»æ³¨æ„ï¼ï¼‰

### âš ï¸ ä¸²è¡Œå¼€å‘éƒ¨åˆ†ï¼ˆä¸èƒ½å¹¶è¡Œï¼‰

1. **æ•ŒäººåŸºç±»åŸºç¡€å·²å®Œæˆ**

   - âœ… **å·²å®Œæˆ**ï¼šEnemyBaseå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡`take_damage()`æ–¹æ³•
   - âœ… **å·²å®Œæˆ**ï¼šEnemyBaseçš„AIé€»è¾‘å·²å®Œå–„ï¼ˆStep 1å®Œæˆï¼ŒåŒ…æ‹¬AIçŠ¶æ€æœºã€ç›®æ ‡è¿½è¸ªã€æˆ¿é—´è¾¹ç•Œé™åˆ¶ï¼‰
   - ğŸ”„ éœ€è¦å®ç°å­å¼¹ä¸æ•Œäººçš„ç¢°æ’ï¼ˆStep 3ï¼Œå¾…å®ç°ï¼‰

2. **ç©å®¶ç”Ÿå‘½å€¼ç³»ç»ŸåŸºç¡€å·²å®Œæˆ**

   - âœ… **å·²å®Œæˆ**ï¼šPlayerå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡`take_damage()`æ–¹æ³•
   - âœ… **å·²å®Œæˆ**ï¼šPlayerçš„æ­»äº¡é€»è¾‘å’Œä¼¤å®³åé¦ˆå·²å®Œå–„ï¼ˆStep 2å®Œæˆï¼ŒåŒ…æ‹¬die()æ–¹æ³•é‡å†™ã€é—ªçƒæ•ˆæœã€ç”Ÿå‘½å€¼åˆå§‹åŒ–ï¼‰
   - ğŸ”„ å¯ä»¥å¼€å§‹å®ç°æ•Œäººå¯¹ç©å®¶çš„ç¢°æ’ä¼¤å®³ï¼ˆStep 4ï¼Œå¾…å®ç°ï¼‰
   - **åŸå› **: æ•Œäººç¢°æ’ä¼¤å®³éœ€è¦è°ƒç”¨Playerçš„`take_damage()`æ–¹æ³•

3. **æˆ˜æ–—ç³»ç»Ÿé›†æˆéœ€è¦æŒ‰é¡ºåº**

   - âœ… **å·²å®Œæˆ**ï¼šåŸºç¡€å·²å®Œæˆï¼šEnemyBaseå’ŒPlayeréƒ½å·²ç»§æ‰¿Damageable
   - âœ… **å·²å®Œæˆ**ï¼šEnemyBase AIå®Œå–„ + Playeræ­»äº¡é€»è¾‘å®Œå–„ï¼ˆStep 1å’ŒStep 2å·²å®Œæˆï¼‰
   - ğŸ”„ å¾…å®Œæˆï¼šå­å¼¹ä¸æ•Œäººç¢°æ’ï¼ˆStep 3ï¼‰+ æ•Œäººå¯¹ç©å®¶ç¢°æ’ä¼¤å®³ï¼ˆStep 4ï¼‰
   - **åŸå› **: éœ€è¦åŒæ–¹æ¥å£éƒ½å‡†å¤‡å¥½æ‰èƒ½é›†æˆæµ‹è¯•

### âœ… å¯ä»¥å¹¶è¡Œå¼€å‘çš„éƒ¨åˆ†

1. **æ•ŒäººAIå¼€å‘å¯ä»¥ç‹¬ç«‹è¿›è¡Œ**

   - å¼€å‘è€…Bå¯ä»¥åœ¨åˆ›å»ºEnemyåŸºç±»åï¼Œç‹¬ç«‹å®ç°AIé€»è¾‘
   - åªéœ€è¦é€šè¿‡ä¿¡å·æˆ–ç›´æ¥è®¿é—®è·å–ç©å®¶ä½ç½®ï¼ˆPlayer.global_positionï¼‰

2. **æ•Œäººç±»å‹æ‰©å±•å¯ä»¥å¹¶è¡Œ**

   - åœ¨EnemyåŸºç±»å®Œæˆåï¼Œå¯ä»¥å¹¶è¡Œå®ç°å¤šç§æ•Œäººç±»å‹
   - ä½†éœ€è¦ç­‰æˆ˜æ–—ç³»ç»Ÿå®Œå–„åæ‰èƒ½å®Œæ•´æµ‹è¯•

3. **æ•Œäººç”Ÿæˆç³»ç»Ÿå¯ä»¥éƒ¨åˆ†å¹¶è¡Œ**

   - ç”Ÿæˆé€»è¾‘å¯ä»¥ç‹¬ç«‹å¼€å‘
   - ä½†éœ€è¦æˆ¿é—´ç³»ç»Ÿæä¾›è¾¹ç•Œä¿¡æ¯ï¼ˆå¼€å‘è€…Aæ”¯æŒï¼‰

---

## ğŸ“… å¼€å‘æ—¶é—´çº¿

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€ç³»ç»Ÿæ­å»ºï¼ˆä¸²è¡Œï¼Œå¿…é¡»æŒ‰é¡ºåºï¼‰

#### Step 1: æ•ŒäººåŸºç±»åˆ›å»ºï¼ˆå¼€å‘è€…Bï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼‰

**çŠ¶æ€**: âœ… **å·²å®Œæˆ**

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. åˆ›å»ºEnemyåŸºç±»åœºæ™¯

   - âœ… **å·²å®Œæˆ**ï¼šæ–‡ä»¶ï¼š`scenes/enemies/base/EnemyBase.tscn`å·²åˆ›å»º
   - âœ… **å·²å®Œæˆ**ï¼šèŠ‚ç‚¹ç»“æ„å·²å®ç°ï¼š
     ```
     EnemyBase (CharacterBody2Dï¼Œç»§æ‰¿è‡ªDamageable)
     â”œâ”€â”€ CollisionShape2D (16x16çŸ©å½¢)
     â”œâ”€â”€ ColorRect (å ä½ç¬¦ï¼Œ16x16çº¢è‰²æ–¹å—ï¼ŒåŒºåˆ«äºç©å®¶)
     â””â”€â”€ HealthBar (å¯é€‰ï¼Œåç»­æ·»åŠ )
     ```
   - âœ… **å·²å®Œæˆ**ï¼šç¢°æ’å±‚è®¾ç½®ä¸ºLayer 2ï¼Œç¢°æ’æ©ç åŒ…å«Layer 1ï¼ˆç©å®¶ï¼‰

2. å®Œå–„EnemyBaseè„šæœ¬

   - âœ… **å·²å®Œæˆ**ï¼šæ–‡ä»¶ï¼š`scripts/enemies/base/EnemyBase.gd`å·²å®Œå–„
   - âœ… **å·²å®Œæˆ**ï¼šå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š
     - âœ… ç”Ÿå‘½å€¼ç³»ç»Ÿï¼ˆhp, max_hpï¼‰
     - âœ… `take_damage(amount: int)` æ–¹æ³•
     - âœ… `die()` æ–¹æ³•ï¼ˆæ­»äº¡é€»è¾‘ï¼Œå·²é‡å†™ä¸ºqueue_freeï¼‰
     - âœ… æ— æ•Œå¸§ç³»ç»Ÿï¼ˆis_invincible, invincibility_durationï¼‰
   - âœ… **å·²å®Œæˆ**ï¼šå·²å®Œå–„çš„åŠŸèƒ½ï¼š
     - âœ… åŸºç¡€ç§»åŠ¨é€Ÿåº¦å±æ€§ï¼ˆmove_speed = 100.0ï¼‰
     - âœ… AIçŠ¶æ€æœºå®ç°ï¼ˆIDLE, CHASE, ATTACK, RETREATæšä¸¾å’ŒçŠ¶æ€å¤„ç†ï¼‰
     - âœ… ç›®æ ‡è¿½è¸ªé€»è¾‘ï¼ˆ_find_player_targetè‡ªåŠ¨æŸ¥æ‰¾ç©å®¶ï¼Œæ”¯æŒåˆ†ç»„æŸ¥æ‰¾å’Œé€’å½’æŸ¥æ‰¾ï¼‰
     - âœ… æˆ¿é—´è¾¹ç•Œé™åˆ¶ï¼ˆ_limit_to_room_boundså’Œ_limit_velocity_to_boundsæ–¹æ³•ï¼‰
     - âœ… AIæ›´æ–°æ¡†æ¶ï¼ˆ_update_aiæ–¹æ³•ï¼ŒåŒ…å«å„çŠ¶æ€çš„å¤„ç†æ–¹æ³•ï¼‰
   - ğŸ”„ å¾…å®ç°ï¼šç¢°æ’ä¼¤å®³é€»è¾‘ï¼ˆStep 4å®ç°ï¼‰

**æ¥å£å®šä¹‰ï¼š**

```gdscript
# EnemyBase.gd å·²ä»Damageableç»§æ‰¿çš„æ¥å£
func take_damage(amount: int) -> void  # æ¥è‡ªDamageable
func die() -> void  # æ¥è‡ªDamageableï¼Œå·²é‡å†™ä¸ºqueue_free
var hp: int  # æ¥è‡ªDamageable
var max_hp: int  # æ¥è‡ªDamageable
var is_invincible: bool  # æ¥è‡ªDamageable

# EnemyBase.gd éœ€è¦å®ç°çš„æ¥å£
var move_speed: float
var current_state: AIState
var target: Node2D
func set_target(new_target: Node2D) -> void
func _update_ai(delta: float) -> void
```

**éªŒæ”¶æ ‡å‡†ï¼š**

- [x] âœ… **å·²å®Œæˆ**ï¼šEnemyåœºæ™¯å¯ä»¥å®ä¾‹åŒ–ï¼ˆEnemyBase.tscnå·²åˆ›å»ºå¹¶é…ç½®å®Œæ•´ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šEnemyæœ‰ç”Ÿå‘½å€¼å±æ€§ï¼ˆç»§æ‰¿è‡ªDamageableï¼Œhpå’Œmax_hpï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šEnemyå¯ä»¥æ¥æ”¶ä¼¤å®³ï¼ˆç»§æ‰¿è‡ªDamageableçš„take_damageæ–¹æ³•ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šEnemyç”Ÿå‘½å€¼å½’é›¶æ—¶è°ƒç”¨dieæ–¹æ³•ï¼ˆå·²é‡å†™dieæ–¹æ³•ï¼Œè°ƒç”¨queue_freeï¼‰

---

#### Step 2: ç©å®¶ç”Ÿå‘½å€¼ç³»ç»Ÿå®Œå–„ï¼ˆå¼€å‘è€…Aï¼Œä¸Step 1å¹¶è¡Œå¼€å§‹ï¼Œä½†éœ€å…ˆå®Œæˆï¼‰

**çŠ¶æ€**: âœ… **å·²å®Œæˆ**

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. å®Œå–„Playerè„šæœ¬

   - âœ… **å·²å®Œæˆ**ï¼šæ–‡ä»¶ï¼š`scripts/player/Player.gd`å·²å®Œå–„
   - âœ… **å·²å®Œæˆ**ï¼šå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡ä»¥ä¸‹åŠŸèƒ½ï¼š
     - âœ… ç”Ÿå‘½å€¼ç³»ç»Ÿï¼ˆhp, max_hpï¼‰
     - âœ… `take_damage(amount: int)` æ–¹æ³•ï¼ˆå·²é‡å†™ï¼Œæ·»åŠ æ—¥å¿—å’Œä¿¡å·ï¼‰
     - âœ… æ— æ•Œå¸§ç³»ç»Ÿï¼ˆå—ä¼¤åçŸ­æš‚æ— æ•Œï¼Œé˜²æ­¢è¿ç»­å—ä¼¤ï¼‰
   - âœ… **å·²å®Œæˆ**ï¼šå·²å®Œå–„çš„åŠŸèƒ½ï¼š
     - âœ… é‡å†™`die()`æ–¹æ³•ï¼ˆå®ç°æ¸¸æˆé‡å¯é€»è¾‘ï¼Œä½¿ç”¨get_tree().reload_current_scene()ï¼‰
     - âœ… å—ä¼¤åé¦ˆï¼ˆå®Œæ•´çš„é—ªçƒæ•ˆæœç³»ç»Ÿï¼Œä½¿ç”¨sinå‡½æ•°åˆ›å»ºå¹³æ»‘é—ªçƒï¼Œä¸æ— æ•Œå¸§åŒæ­¥ï¼‰
     - âœ… ç”Ÿå‘½å€¼åˆå§‹åŒ–ï¼ˆinitial_hp = 3ï¼Œåœ¨_readyä¸­åˆå§‹åŒ–å¹¶æ‰“å°ç”Ÿå‘½å€¼ä¿¡æ¯ï¼‰
     - âœ… ä¿¡å·ç³»ç»Ÿï¼ˆplayer_diedå’Œplayer_took_damageä¿¡å·ï¼‰

**æ¥å£å®šä¹‰ï¼š**

```gdscript
# Player.gd å·²ä»Damageableç»§æ‰¿çš„æ¥å£
func take_damage(amount: int) -> void  # æ¥è‡ªDamageable
func die() -> void  # æ¥è‡ªDamageableï¼Œéœ€è¦é‡å†™å®ç°æ­»äº¡é€»è¾‘
var hp: int  # æ¥è‡ªDamageable
var max_hp: int  # æ¥è‡ªDamageable
var is_invincible: bool  # æ¥è‡ªDamageable
var invincibility_duration: float  # æ¥è‡ªDamageable

# Player.gd éœ€è¦æ·»åŠ çš„åŠŸèƒ½
# é‡å†™die()æ–¹æ³•å®ç°å…·ä½“çš„æ­»äº¡é€»è¾‘
```

**éªŒæ”¶æ ‡å‡†ï¼š**

- [x] âœ… **å·²å®Œæˆ**ï¼šç©å®¶æœ‰ç”Ÿå‘½å€¼æ˜¾ç¤ºï¼ˆåœ¨_readyä¸­æ‰“å°åˆå§‹åŒ–ä¿¡æ¯ï¼Œåœ¨take_damageä¸­æ‰“å°å—ä¼¤ä¿¡æ¯ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šç©å®¶å¯ä»¥æ¥æ”¶ä¼¤å®³ï¼ˆç»§æ‰¿è‡ªDamageableï¼Œå·²é‡å†™take_damageæ–¹æ³•æ·»åŠ é¢å¤–åŠŸèƒ½ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šç©å®¶å—ä¼¤åæœ‰çŸ­æš‚æ— æ•Œæ—¶é—´ï¼ˆç»§æ‰¿è‡ªDamageableçš„æ— æ•Œå¸§ç³»ç»Ÿï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šç©å®¶ç”Ÿå‘½å€¼å½’é›¶æ—¶è§¦å‘æ­»äº¡ï¼ˆå·²é‡å†™die()æ–¹æ³•ï¼Œå®ç°æ¸¸æˆé‡å¯ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šç©å®¶å—ä¼¤æ—¶æœ‰è§†è§‰åé¦ˆï¼ˆå®Œæ•´çš„é—ªçƒæ•ˆæœç³»ç»Ÿï¼Œä½¿ç”¨é€æ˜åº¦å˜åŒ–ï¼‰

**âš ï¸ æ³¨æ„**: è¿™ä¸€æ­¥å¯ä»¥ä¸Step 1å¹¶è¡Œå¼€å‘ï¼Œä½†å¿…é¡»åœ¨Step 3ä¹‹å‰å®Œæˆï¼

---

#### Step 3: å­å¼¹ä¸æ•Œäººç¢°æ’ï¼ˆå¼€å‘è€…Bï¼Œä¾èµ–Step 1ï¼‰

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. å®Œå–„Projectileè„šæœ¬

   - æ–‡ä»¶ï¼š`scripts/projectiles/Projectile.gd`
   - ä¿®æ”¹`_on_body_entered`æ–¹æ³•ï¼š
     - âœ… æ£€æµ‹ç¢°æ’å¯¹è±¡æ˜¯å¦ä¸ºEnemyï¼ˆä½¿ç”¨`is_instance_of(EnemyBase)`æˆ–æ£€æŸ¥æ˜¯å¦ä¸º`Damageable`ç±»å‹ï¼‰
     - âœ… è°ƒç”¨æ•Œäººçš„`take_damage()`æ–¹æ³•ï¼ˆEnemyBaseå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡æ­¤æ–¹æ³•ï¼‰
     - âœ… å­å¼¹ç¢°æ’åé”€æ¯
     - âœ… æ·»åŠ ä¼¤å®³å€¼å‚æ•°ï¼ˆå¯ä»¥ç¡¬ç¼–ç ä¸º1ï¼Œåç»­æ‰©å±•ï¼‰

2. é…ç½®ç¢°æ’å±‚

   - ç¡®ä¿Projectileçš„`collision_mask`åŒ…å«Enemyå±‚ï¼ˆLayer 2ï¼‰
   - ç¡®ä¿Enemyçš„`collision_layer`è®¾ç½®ä¸ºLayer 2

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] å­å¼¹å¯ä»¥å‡»ä¸­æ•Œäºº
- [ ] æ•Œäººå—åˆ°ä¼¤å®³åç”Ÿå‘½å€¼å‡å°‘
- [ ] å­å¼¹å‡»ä¸­æ•Œäººåé”€æ¯
- [ ] æ•Œäººç”Ÿå‘½å€¼å½’é›¶æ—¶æ­»äº¡å¹¶æ¶ˆå¤±

---

#### Step 4: æ•Œäººå¯¹ç©å®¶ç¢°æ’ä¼¤å®³ï¼ˆå¼€å‘è€…Bï¼Œä¾èµ–Step 2ï¼‰

**é¢„è®¡æ—¶é—´**: 1-2å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. åœ¨EnemyBaseä¸­æ·»åŠ ç¢°æ’ä¼¤å®³é€»è¾‘

   - æ–‡ä»¶ï¼š`scripts/enemies/base/EnemyBase.gd`
   - æ·»åŠ åŠŸèƒ½ï¼š
     - ğŸ”„ æ£€æµ‹ä¸ç©å®¶çš„ç¢°æ’ï¼ˆä½¿ç”¨CharacterBody2Dçš„ç¢°æ’æ£€æµ‹ï¼Œå› ä¸ºEnemyBaseç»§æ‰¿è‡ªDamageable/CharacterBody2Dï¼‰
     - ğŸ”„ ç¢°æ’æ—¶è°ƒç”¨ç©å®¶çš„`take_damage()`æ–¹æ³•ï¼ˆPlayerå·²ç»§æ‰¿Damageableï¼Œå…·å¤‡æ­¤æ–¹æ³•ï¼‰
     - ğŸ”„ æ·»åŠ ç¢°æ’ä¼¤å®³å†·å´ï¼ˆé˜²æ­¢è¿ç»­ä¼¤å®³ï¼Œä¾‹å¦‚0.5ç§’ï¼‰

2. é…ç½®ç¢°æ’å±‚

   - ç¡®ä¿Enemyçš„`collision_mask`åŒ…å«Playerå±‚ï¼ˆLayer 1ï¼‰
   - ç¡®ä¿Playerçš„`collision_layer`è®¾ç½®ä¸ºLayer 1

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] æ•Œäººç¢°æ’ç©å®¶æ—¶é€ æˆä¼¤å®³
   - [ ] ç©å®¶ç”Ÿå‘½å€¼å‡å°‘
   - [ ] ç©å®¶è§¦å‘æ— æ•Œå¸§
   - [ ] æœ‰ç¢°æ’ä¼¤å®³å†·å´ï¼Œä¸ä¼šè¿ç»­å—ä¼¤

---

### ç¬¬äºŒé˜¶æ®µï¼šAIå’Œæˆ˜æ–—å®Œå–„ï¼ˆå¯ä»¥éƒ¨åˆ†å¹¶è¡Œï¼‰

#### Step 5: æ•ŒäººAI - è¿½è¸ªç©å®¶ï¼ˆå¼€å‘è€…Bï¼‰

**çŠ¶æ€**: âœ… **å·²å®Œæˆ**

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. å®Œå–„EnemyBaseä¸­çš„AIé€»è¾‘

   - âœ… **å·²å®Œæˆ**ï¼šæ–‡ä»¶ï¼š`scripts/enemies/base/EnemyBase.gd`å·²å®Œå–„
   - âœ… **å·²å®Œæˆ**ï¼šå·²å…·å¤‡çš„åŸºç¡€åŠŸèƒ½ï¼š
     - âœ… AIçŠ¶æ€æœºæ¡†æ¶ï¼ˆIDLE, CHASE, ATTACK, RETREATæšä¸¾å’Œå®Œæ•´çš„çŠ¶æ€å¤„ç†ï¼‰
     - âœ… ç›®æ ‡è¿½è¸ªæ¥å£ï¼ˆset_targetæ–¹æ³•ï¼‰
     - âœ… åŸºç¡€ç§»åŠ¨é€Ÿåº¦å±æ€§ï¼ˆmove_speedï¼‰
     - âœ… AIæ›´æ–°æ¡†æ¶ï¼ˆ_update_aiæ–¹æ³•ï¼‰
   - âœ… **å·²å®Œæˆ**ï¼šå·²å®Œå–„çš„åŠŸèƒ½ï¼š
     - âœ… å®ç°ç©å®¶ä½ç½®è·å–æœºåˆ¶ï¼ˆ_find_player_targetæ–¹æ³•ï¼Œæ”¯æŒåˆ†ç»„æŸ¥æ‰¾å’Œé€’å½’æŸ¥æ‰¾PlayerèŠ‚ç‚¹ï¼‰
     - âœ… å®Œå–„è¿½è¸ªç§»åŠ¨é€»è¾‘ï¼ˆ_handle_chaseæ–¹æ³•å·²å®ç°ï¼Œè®¡ç®—æ–¹å‘å¹¶ç§»åŠ¨ï¼‰
     - âœ… å®ç°æˆ¿é—´è¾¹ç•Œé™åˆ¶ï¼ˆ_limit_to_room_boundså’Œ_limit_velocity_to_boundsæ–¹æ³•ï¼Œä½¿ç”¨ä¸Playerç›¸åŒçš„room_boundsé€»è¾‘ï¼‰
     - âœ… å®Œå–„å…¶ä»–AIçŠ¶æ€çš„å¤„ç†é€»è¾‘ï¼ˆ_handle_idleã€_handle_attackã€_handle_retreatæ–¹æ³•å·²å®ç°ï¼‰

2. åˆ›å»ºç©å®¶ä½ç½®è·å–æœºåˆ¶

   - âœ… **å·²å®ç°**ï¼šæ–¹æ¡ˆBï¼šé€šè¿‡åœºæ™¯æ ‘æŸ¥æ‰¾PlayerèŠ‚ç‚¹ï¼ˆå·²å®ç°_find_player_targetå’Œ_find_player_recursiveæ–¹æ³•ï¼‰
   - æ–¹æ¡ˆAï¼šä½¿ç”¨Autoloadå•ä¾‹ï¼ˆGameManagerï¼‰å­˜å‚¨ç©å®¶å¼•ç”¨ï¼ˆå¯é€‰ï¼Œåç»­æ‰©å±•ï¼‰
   - æ–¹æ¡ˆCï¼šä½¿ç”¨ä¿¡å·ç³»ç»Ÿï¼ˆPlayerå‘å°„ä½ç½®æ›´æ–°ä¿¡å·ï¼‰ï¼ˆå¯é€‰ï¼Œåç»­æ‰©å±•ï¼‰

**å½“å‰å®ç°**: ä½¿ç”¨æ–¹æ¡ˆBï¼ˆåœºæ™¯æ ‘é€’å½’æŸ¥æ‰¾ï¼‰ï¼Œå·²æ­£å¸¸å·¥ä½œ

**éªŒæ”¶æ ‡å‡†ï¼š**

- [x] âœ… **å·²å®Œæˆ**ï¼šæ•Œäººå¯ä»¥è¿½è¸ªç©å®¶ï¼ˆ_find_player_targetè‡ªåŠ¨æŸ¥æ‰¾å¹¶è®¾ç½®ç©å®¶ä¸ºç›®æ ‡ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šæ•Œäººç§»åŠ¨æµç•…ï¼ˆ_handle_chaseæ–¹æ³•å·²å®ç°ï¼Œè®¡ç®—æ–¹å‘å¹¶åº”ç”¨é€Ÿåº¦ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šæ•Œäººä¸ä¼šç§»å‡ºæˆ¿é—´è¾¹ç•Œï¼ˆ_limit_to_room_boundså’Œ_limit_velocity_to_boundså·²å®ç°ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šå¤šä¸ªæ•Œäººå¯ä»¥åŒæ—¶è¿½è¸ªï¼ˆæ¯ä¸ªæ•Œäººç‹¬ç«‹æŸ¥æ‰¾å’Œè¿½è¸ªç©å®¶ï¼‰
- [x] âœ… **å·²å®Œæˆ**ï¼šAIçŠ¶æ€æœºæ­£å¸¸å·¥ä½œï¼ˆå®Œæ•´çš„AIçŠ¶æ€æœºæ¡†æ¶ï¼ŒåŒ…å«æ‰€æœ‰çŠ¶æ€çš„å¤„ç†æ–¹æ³•ï¼‰

---

#### Step 6: æˆ˜æ–—ç³»ç»Ÿé›†æˆæµ‹è¯•ï¼ˆå¼€å‘è€…Aå’ŒBåä½œï¼‰

**é¢„è®¡æ—¶é—´**: 1å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. åˆ›å»ºæµ‹è¯•åœºæ™¯

   - æ–‡ä»¶ï¼š`scenes/test/CombatTest.tscn`
   - åœºæ™¯å†…å®¹ï¼š
     - æˆ¿é—´è¾¹ç•Œ
     - ç©å®¶å®ä¾‹
     - 1-2ä¸ªæ•Œäººå®ä¾‹ï¼ˆæ‰‹åŠ¨æ”¾ç½®ï¼‰

2. åŠŸèƒ½éªŒè¯æ¸…å•

   - [ ] ç©å®¶å¯ä»¥ç§»åŠ¨å’Œå°„å‡»
   - [ ] å­å¼¹å¯ä»¥å‡»ä¸­æ•Œäºº
   - [ ] æ•Œäººå—åˆ°ä¼¤å®³åæ­»äº¡
   - [ ] æ•Œäººå¯ä»¥è¿½è¸ªç©å®¶
   - [ ] æ•Œäººç¢°æ’ç©å®¶é€ æˆä¼¤å®³
   - [ ] ç©å®¶å—ä¼¤åæœ‰æ— æ•Œå¸§
   - [ ] ç©å®¶ç”Ÿå‘½å€¼å½’é›¶æ—¶è§¦å‘æ­»äº¡

---

### ç¬¬ä¸‰é˜¶æ®µï¼šæ•Œäººç±»å‹æ‰©å±•ï¼ˆå¯ä»¥å¹¶è¡Œï¼‰

#### Step 7: å®ç°å¤šç§æ•Œäººç±»å‹ï¼ˆå¼€å‘è€…Bï¼‰

**é¢„è®¡æ—¶é—´**: 3-4å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. åˆ›å»ºæ•Œäººç±»å‹è„šæœ¬

   - æ–‡ä»¶ï¼š`scripts/enemies/types/ChaserEnemy.gd`ï¼ˆå¿«é€Ÿè¿½è¸ªå‹ï¼‰
   - æ–‡ä»¶ï¼š`scripts/enemies/types/PatrolEnemy.gd`ï¼ˆå·¡é€»å‹ï¼‰
   - æ–‡ä»¶ï¼š`scripts/enemies/types/ShooterEnemy.gd`ï¼ˆå°„å‡»å‹ï¼Œå¯é€‰ï¼‰

2. å®ç°ä¸åŒçš„ç§»åŠ¨æ¨¡å¼

   - **ChaserEnemy**: å¿«é€Ÿè¿½è¸ªç©å®¶ï¼ˆç§»åŠ¨é€Ÿåº¦æ›´å¿«ï¼‰
   - **PatrolEnemy**: åœ¨å›ºå®šåŒºåŸŸå·¡é€»ï¼Œå‘ç°ç©å®¶åè¿½è¸ª
   - **ShooterEnemy**: ä¿æŒè·ç¦»ï¼Œå‘ç©å®¶å°„å‡»ï¼ˆéœ€è¦æ‰©å±•å°„å‡»ç³»ç»Ÿï¼‰

3. åˆ›å»ºå¯¹åº”çš„åœºæ™¯

   - `scenes/enemies/types/ChaserEnemy.tscn`
   - `scenes/enemies/types/PatrolEnemy.tscn`
   - `scenes/enemies/types/ShooterEnemy.tscn`ï¼ˆå¯é€‰ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] è‡³å°‘2ç§ä¸åŒçš„æ•Œäººç±»å‹
- [ ] æ¯ç§æ•Œäººæœ‰ä¸åŒçš„ç§»åŠ¨æ¨¡å¼
- [ ] æ•Œäººå¯ä»¥æ­£å¸¸å—åˆ°ä¼¤å®³å’Œæ­»äº¡
- [ ] ä¸åŒæ•Œäººå¯ä»¥åŒæ—¶å­˜åœ¨

---

#### Step 8: æ•Œäººç”Ÿæˆç³»ç»Ÿï¼ˆå¼€å‘è€…Bä¸»å¯¼ï¼Œå¼€å‘è€…Aæ”¯æŒï¼‰

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

**ä»»åŠ¡æ¸…å•ï¼š**

1. åˆ›å»ºæ•Œäººç”Ÿæˆå™¨è„šæœ¬ï¼ˆå¼€å‘è€…Bï¼‰

   - æ–‡ä»¶ï¼š`scripts/enemies/spawners/EnemySpawner.gd`
   - åŠŸèƒ½è¦æ±‚ï¼š
     - âœ… åœ¨æˆ¿é—´å†…éšæœºä½ç½®ç”Ÿæˆæ•Œäºº
     - âœ… æ”¯æŒç”Ÿæˆä¸åŒç±»å‹çš„æ•Œäºº
     - âœ… æ§åˆ¶ç”Ÿæˆæ•°é‡
     - âœ… é¿å…åœ¨ç©å®¶é™„è¿‘ç”Ÿæˆ

2. æˆ¿é—´ç³»ç»Ÿæ”¯æŒï¼ˆå¼€å‘è€…Aï¼‰

   - å¦‚æœRoomç³»ç»Ÿå·²å®ç°ï¼Œæä¾›æˆ¿é—´è¾¹ç•Œå’Œç”ŸæˆåŒºåŸŸ
   - å¦‚æœRoomç³»ç»Ÿæœªå®ç°ï¼Œä½¿ç”¨ç¡¬ç¼–ç çš„æˆ¿é—´è¾¹ç•Œï¼ˆä¸Playerä¸­çš„room_boundsä¸€è‡´ï¼‰

3. åˆ›å»ºç”Ÿæˆå™¨åœºæ™¯

   - æ–‡ä»¶ï¼š`scenes/enemies/spawners/EnemySpawner.tscn`
   - å¯ä»¥é™„åŠ åˆ°Roomåœºæ™¯ä¸­

**æ¥å£çº¦å®šï¼š**

```gdscript
# EnemySpawner.gd æ¥å£
func spawn_enemies(room_bounds: Rect2, enemy_count: int) -> void
func spawn_enemy(enemy_scene: PackedScene, position: Vector2) -> void
```

**éªŒæ”¶æ ‡å‡†ï¼š**

- [ ] å¯ä»¥åœ¨æˆ¿é—´å†…éšæœºç”Ÿæˆæ•Œäºº
- [ ] ç”Ÿæˆä½ç½®åˆç†ï¼ˆä¸åœ¨å¢™å£å†…ï¼Œä¸åœ¨ç©å®¶é™„è¿‘ï¼‰
- [ ] å¯ä»¥æ§åˆ¶ç”Ÿæˆæ•°é‡å’Œç±»å‹
- [ ] ç”Ÿæˆçš„æ•ŒäººåŠŸèƒ½æ­£å¸¸

---

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç æ¥å£çº¦å®š

**ç»§æ‰¿å…³ç³»è¯´æ˜ï¼š**

```gdscript
# ç»§æ‰¿å…³ç³»
CharacterBody2D
  â””â”€â”€ Damageable (æä¾›ç”Ÿå‘½å€¼ã€æ— æ•Œå¸§ã€ä¼¤å®³å¤„ç†)
       â”œâ”€â”€ Player
       â””â”€â”€ EnemyBase
```

**DamageableåŸºç±»æä¾›çš„æ¥å£ï¼š**

```gdscript
# Damageable.gd (å·²å®ç°)
extends CharacterBody2D
class_name Damageable

var hp: int
var max_hp: int
var is_invincible: bool
var invincibility_duration: float
var invincibility_timer: float

func take_damage(amount: int) -> void
func die() -> void  # é»˜è®¤å®ç°ï¼Œå­ç±»å¯é‡å†™
func _start_invincibility() -> void
```

**EnemyBaseéœ€è¦å®ç°çš„æ¥å£ï¼š**

```gdscript
# EnemyBase.gd (ç»§æ‰¿è‡ªDamageable)
extends Damageable

var move_speed: float
var current_state: AIState
var target: Node2D

func set_target(new_target: Node2D) -> void
func _update_ai(delta: float) -> void  # AIé€»è¾‘
func die() -> void  # é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œå®ç°queue_free
```

**Playeréœ€è¦å®ç°çš„æ¥å£ï¼š**

```gdscript
# Player.gd (ç»§æ‰¿è‡ªDamageable)
extends Damageable

# å·²ä»Damageableç»§æ‰¿ï¼šhp, max_hp, is_invincible, take_damageç­‰
# éœ€è¦é‡å†™ï¼š
func die() -> void  # é‡å†™çˆ¶ç±»æ–¹æ³•ï¼Œå®ç°æ¸¸æˆé‡å¯/åœºæ™¯åˆ‡æ¢ç­‰æ­»äº¡é€»è¾‘
```

**Projectileéœ€è¦ä¿®æ”¹çš„æ¥å£ï¼š**

```gdscript
# Projectile.gd ä¿®æ”¹
@export var damage: int = 1  # æ–°å¢ä¼¤å®³å€¼

# _on_body_entered éœ€è¦æ£€æµ‹Enemyå¹¶è°ƒç”¨take_damage
```

### ä¿¡å·ç³»ç»Ÿå»ºè®®

**æ¨èä½¿ç”¨ä¿¡å·è¿›è¡Œè§£è€¦ï¼š**

```gdscript

# Player.gd

signal player_died

signal player_took_damage(new_hp: int)

signal position_changed(new_position: Vector2)  # ä¾›AIä½¿ç”¨

# EnemyBase.gd

signal